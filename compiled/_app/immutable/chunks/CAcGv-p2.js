import{w as u,x as v,y as d,z as k,A as l,B as _,C as y,D as A,E as o,F as T,G as g,H as m,I as E,J as M,K as S,L as w,M as F,N as b,O as x,P as B,b as D,Q as N,S as R}from"./C8ZltreA.js";class C{anchor;#s=new Map;#t=new Map;#e=new Map;#a=!0;constructor(e,a=!0){this.anchor=e,this.#a=a}#r=()=>{var e=u;if(this.#s.has(e)){var a=this.#s.get(e),t=this.#t.get(a);if(t)v(t);else{var r=this.#e.get(a);r&&(this.#t.set(a,r.effect),this.#e.delete(a),r.fragment.lastChild.remove(),this.anchor.before(r.fragment),t=r.effect)}for(const[s,i]of this.#s){if(this.#s.delete(s),s===e)break;const f=this.#e.get(i);f&&(d(f.effect),this.#e.delete(i))}for(const[s,i]of this.#t){if(s===a)continue;const f=()=>{if(Array.from(this.#s.values()).includes(s)){var n=document.createDocumentFragment();y(i,n),n.append(l()),this.#e.set(s,{effect:i,fragment:n})}else d(i);this.#t.delete(s)};this.#a||!t?k(i,f,!1):f()}}};#i=e=>{this.#s.delete(e);const a=Array.from(this.#s.values());for(const[t,r]of this.#e)a.includes(t)||(d(r.effect),this.#e.delete(t))};ensure(e,a){var t=u,r=A();if(a&&!this.#t.has(e)&&!this.#e.has(e))if(r){var s=document.createDocumentFragment(),i=l();s.append(i),this.#e.set(e,{effect:_(()=>a(i)),fragment:s})}else this.#t.set(e,_(()=>a(this.anchor)));if(this.#s.set(t,e),r){for(const[f,h]of this.#t)f===e?t.skipped_effects.delete(h):t.skipped_effects.add(h);for(const[f,h]of this.#e)f===e?t.skipped_effects.delete(h.effect):t.skipped_effects.add(h.effect);t.oncommit(this.#r),t.ondiscard(this.#i)}else o&&(this.anchor=T),this.#r()}}function O(c,e,a=!1){o&&E();var t=new C(c),r=a?m:0;function s(i,f){if(o){const n=M(c)===S;if(i===n){var h=w();F(h),t.anchor=h,b(!1),t.ensure(i,f),b(!0);return}}t.ensure(i,f)}g(()=>{var i=!1;e((f,h=!0)=>{i=!0,s(h,f)}),i||s(!1,null)},r)}function p(c,e){return c===e||c?.[R]===e}function H(c={},e,a,t){return x(()=>{var r,s;return B(()=>{r=s,s=[],D(()=>{c!==a(...s)&&(e(c,...s),r&&p(a(...r),c)&&e(null,...r))})}),()=>{N(()=>{s&&p(a(...s),c)&&e(null,...s)})}}),c}export{C as B,H as b,O as i};
